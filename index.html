<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Wingo Pro - Time Synced Engine</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #FFC107; --primary-dark: #FF9800;
            --bg-dark: #121212; --bg-card: #1E1E1E; --bg-input: #2C2C2C;
            --green: #28A745; --red: #DC3545; --violet: #6F42C1;
            --blue: #007BFF; --text-white: #FFFFFF; --text-grey: #B0B3B8;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { margin: 0; font-family: 'Roboto', sans-serif; background-color: var(--bg-dark); color: var(--text-white); padding-bottom: 70px; overflow-x: hidden; }
        
        .flex { display: flex; } .flex-col { flex-direction: column; } .justify-between { justify-content: space-between; } .items-center { align-items: center; } .text-center { text-align: center; }
        .mt-2 { margin-top: 10px; } .mb-2 { margin-bottom: 10px; } .p-3 { padding: 15px; } .hidden { display: none !important; } .w-full { width: 100%; }
        
        @keyframes pop { 0% { transform: scale(0.9); opacity: 0; } 100% { transform: scale(1); opacity: 1; } } .pop-in { animation: pop 0.3s ease-out; }
        @keyframes pulse-red { 0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(220, 53, 69, 0); } 100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); } }

        /* Auth */
        #auth-screen { min-height: 100vh; background: linear-gradient(135deg, #000000, #1a1a1a); display: flex; flex-direction: column; justify-content: center; padding: 30px; }
        .auth-title { font-size: 28px; font-weight: 900; color: var(--primary); margin-bottom: 30px; text-align: center; letter-spacing: 1px; }
        .input-group { margin-bottom: 20px; position: relative; }
        .wingo-input { width: 100%; background: var(--bg-input); border: 1px solid #333; color: white; padding: 15px 15px 15px 45px; border-radius: 8px; font-size: 16px; }
        .wingo-input:focus { border-color: var(--primary); }
        .input-icon { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--text-grey); }
        .wingo-btn { background: linear-gradient(90deg, var(--primary), var(--primary-dark)); color: #000; border: none; padding: 15px; border-radius: 8px; font-weight: 800; font-size: 18px; width: 100%; cursor: pointer; text-transform: uppercase; box-shadow: 0 4px 10px rgba(255, 193, 7, 0.3); }
        .wingo-btn:active { transform: scale(0.98); }

        /* Header */
        .app-header { background: #000; padding: 15px 20px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 50; }
        .balance-pill { background: var(--primary); color: #000; padding: 6px 15px; border-radius: 20px; font-weight: 800; display: flex; align-items: center; gap: 5px; font-size: 14px; }

        /* Game Area */
        .game-info-bar { display: flex; gap: 10px; padding: 10px 15px; }
        .period-box { flex: 1; background: var(--bg-card); border: 1px solid #333; border-radius: 8px; padding: 10px; display: flex; align-items: center; justify-content: center; flex-direction: column; }
        .period-label { font-size: 12px; color: var(--text-grey); } .period-val { font-weight: bold; font-size: 14px; color: var(--blue); }
        .timer-box { flex: 1; background: linear-gradient(90deg, var(--primary), var(--primary-dark)); border-radius: 8px; padding: 10px; display: flex; align-items: center; justify-content: center; flex-direction: column; }
        #timer { font-size: 22px; font-weight: 900; color: #fff; }
        .history-bar { padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; }
        .history-circles { display: flex; gap: 10px; }
        .res-circle { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 16px; color: white; border: 2px solid rgba(255,255,255,0.2); }

        /* Betting UI */
        .bet-section { padding: 15px; }
        .color-btn-row { display: flex; gap: 10px; margin-bottom: 15px; }
        .b-btn { flex: 1; padding: 12px; border-radius: 8px; border: none; color: white; font-weight: bold; font-size: 16px; display: flex; justify-content: space-between; align-items: center; }
        .bg-green { background: var(--green); } .bg-violet { background: var(--violet); } .bg-red { background: var(--red); } .multiplier { font-size: 12px; opacity: 0.8; }
        .num-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin-bottom: 15px; }
        .n-btn { aspect-ratio: 1; border-radius: 50%; background: var(--bg-card); border: 1px solid #333; color: white; font-weight: bold; font-size: 14px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s; }
        .n-btn.selected { border-color: var(--primary); box-shadow: 0 0 10px rgba(255,193,7,0.5); transform: scale(1.1); }
        .chip-row { display: flex; gap: 10px; overflow-x: auto; margin-bottom: 15px; padding-bottom: 5px; }
        .chip { background: var(--bg-card); border: 1px solid #444; color: white; padding: 8px 20px; border-radius: 20px; font-size: 14px; white-space: nowrap; cursor: pointer; }
        .chip.active { background: var(--primary); color: #000; border-color: var(--primary); font-weight: bold; }
        .confirm-area { background: var(--bg-card); padding: 15px; border-radius: 10px; margin-top: 10px; }
        .qty-input { width: 100%; background: var(--bg-input); border: 1px solid #333; color: white; padding: 10px; border-radius: 5px; margin-bottom: 10px; text-align: center; font-size: 16px; }

        /* History */
        .history-section-title { padding: 10px 15px; font-size: 14px; font-weight: bold; color: var(--text-grey); background: #181818; border-top: 1px solid #333; }
        .history-list { padding: 0 15px; max-height: 250px; overflow-y: auto; background: #121212; }
        .h-item { background: var(--bg-card); border-bottom: 1px solid #333; padding: 12px; display: flex; justify-content: space-between; align-items: center; }
        .h-left { display: flex; flex-direction: column; }
        .h-period { font-size: 12px; color: var(--text-grey); }
        .h-detail { font-size: 14px; font-weight: bold; color: white; margin-top: 2px; }
        .h-amount { font-size: 16px; font-weight: bold; }
        .status-win { color: var(--green); } .status-loss { color: var(--red); } .status-pending { color: var(--primary); }

        /* Wallet */
        .live-feed-title { background: #2C2C2C; padding: 10px 15px; font-size: 13px; color: var(--text-grey); display: flex; justify-content: space-between; align-items: center; }
        .live-list { padding: 0 15px; max-height: 150px; overflow-y: auto; }
        .live-item { padding: 8px 0; border-bottom: 1px solid #333; font-size: 13px; display: flex; align-items: center; gap: 10px; }
        .wallet-header { background: var(--blue); padding: 30px 20px; border-radius: 0 0 20px 20px; text-align: center; }
        .wallet-tabs { display: flex; margin: -20px 15px 0; background: var(--bg-card); border-radius: 10px; padding: 5px; gap: 5px; }
        .w-tab { flex: 1; padding: 10px; text-align: center; border-radius: 8px; font-size: 14px; font-weight: bold; cursor: pointer; }
        .w-tab.active { background: var(--bg-input); color: var(--primary); border: 1px solid #333; }
        .form-card { padding: 20px; } .wingo-label { display: block; color: var(--text-grey); margin-bottom: 8px; font-size: 12px; }
        .deposit-card { background: #252a33; border: 1px solid #444; padding: 15px; border-radius: 10px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; transition: 0.2s; }
        .deposit-card:active { background: #333; transform: scale(0.98); }
        .copy-btn { background: var(--primary); color: black; border: none; padding: 8px 15px; border-radius: 5px; font-weight: bold; cursor: pointer; font-size: 12px; }

        /* Nav */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: var(--bg-card); border-top: 1px solid #333; display: flex; justify-content: space-around; padding: 8px 0; z-index: 100; }
        .nav-icon { text-align: center; color: var(--text-grey); font-size: 10px; width: 25%; cursor: pointer; }
        .nav-icon i { display: block; font-size: 20px; margin-bottom: 3px; } .nav-icon.active { color: var(--primary); }

        /* Admin */
        .admin-section { border: 1px solid #444; margin: 10px; padding: 10px; border-radius: 8px; background: #1a1a1a; }
        .evil-mode-section { border: 2px solid #444; margin: 10px; padding: 15px; border-radius: 12px; background: #1a1a1a; transition: 0.3s; }
        .evil-mode-section.active-evil { border-color: var(--red); background: #2d0b0b; animation: pulse-red 2s infinite; }
        .evil-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid #550000; padding-bottom: 10px; }
        .evil-title { color: var(--text-grey); font-weight: bold; font-size: 16px; display: flex; align-items: center; gap: 10px; }
        .active-evil .evil-title { color: var(--red); text-shadow: 0 0 5px rgba(220,53,69,0.5); }
        .toggle-switch { position: relative; display: inline-block; width: 50px; height: 24px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--red); }
        input:checked + .slider:before { transform: translateX(26px); }

        /* Modal */
        #win-loss-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); z-index: 2000; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .modal-content { background: #1E1E1E; width: 85%; max-width: 350px; border-radius: 20px; text-align: center; padding: 30px 20px; border: 2px solid #333; position: relative; box-shadow: 0 0 20px rgba(0,0,0,0.8); }
        .modal-content.win { border-color: var(--green); box-shadow: 0 0 30px rgba(40, 167, 69, 0.3); } .modal-content.loss { border-color: var(--red); box-shadow: 0 0 30px rgba(220, 53, 69, 0.3); }
        .modal-icon { width: 80px; height: 80px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; font-size: 40px; }
        .win .modal-icon { background: rgba(40, 167, 69, 0.2); color: var(--green); } .loss .modal-icon { background: rgba(220, 53, 69, 0.2); color: var(--red); }
        .modal-title { font-size: 24px; font-weight: 900; margin: 0 0 10px; } .win .modal-title { color: var(--green); } .loss .modal-title { color: var(--red); }
        .modal-amount { font-size: 36px; font-weight: bold; margin-bottom: 20px; color: white; }
        .modal-btn { background: #333; color: white; border: none; padding: 12px 30px; border-radius: 25px; font-weight: bold; font-size: 16px; cursor: pointer; width: 80%; }
        .win .modal-btn { background: var(--green); } .loss .modal-btn { background: var(--red); }
        #toast-box { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 9999; width: 90%; text-align: center; }
        .toast-msg { background: #333; color: white; padding: 10px 20px; border-radius: 5px; margin-bottom: 5px; animation: pop 0.3s; display: inline-block; font-size: 14px; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        .toast-success { border-left: 4px solid var(--green); } .toast-error { border-left: 4px solid var(--red); }
    </style>
</head>
<body>

    <!-- POPUP -->
    <div id="win-loss-modal" class="hidden">
        <div class="modal-content" id="modal-card">
            <div class="modal-icon"><i class="fas fa-check" id="modal-icon-el"></i></div>
            <h2 class="modal-title" id="modal-title">Congratulations!</h2>
            <div class="modal-amount" id="modal-amt">+500</div>
            <button class="modal-btn" onclick="closePopup()">OK</button>
        </div>
    </div>
    <div id="toast-box"></div>

    <!-- AUTH SCREEN -->
    <div id="auth-screen">
        <div class="logo-area text-center">
            <i class="fas fa-dice-d20 fa-4x" style="color: var(--primary);"></i>
            <h1 class="auth-title">WINGO</h1>
        </div>
        <div id="login-box">
            <div class="input-group"><i class="fas fa-envelope input-icon"></i><input type="email" id="login-user" class="wingo-input" placeholder="Email Address"></div>
            <div class="input-group"><i class="fas fa-lock input-icon"></i><input type="password" id="login-pass" class="wingo-input" placeholder="Password"></div>
            <button class="wingo-btn" onclick="authUser()">Login</button>
            <p class="text-center mt-2" style="color:var(--text-grey); font-size:13px;">Don't have account? <span style="color:var(--primary); font-weight:bold;" onclick="toggleAuth()">Register</span></p>
            <p class="text-center" style="font-size:10px; color:#555; margin-top:20px;">Admin Login: admin@wingo.com / admin123</p>
        </div>
        <div id="register-box" class="hidden">
            <div class="input-group"><i class="fas fa-envelope input-icon"></i><input type="email" id="reg-user" class="wingo-input" placeholder="Email Address"></div>
            <div class="input-group"><i class="fas fa-user input-icon"></i><input type="text" id="reg-name" class="wingo-input" placeholder="Full Name"></div>
            <div class="input-group"><i class="fas fa-lock input-icon"></i><input type="password" id="reg-pass" class="wingo-input" placeholder="Password"></div>
            <button class="wingo-btn" onclick="registerUser()">Register</button>
            <p class="text-center mt-2" style="color:var(--text-grey); font-size:13px;">Already have account? <span style="color:var(--primary); font-weight:bold;" onclick="toggleAuth()">Login</span></p>
        </div>
    </div>

    <!-- USER APP -->
    <div id="user-app" class="hidden">
        <header class="app-header">
            <div class="user-info"><h3 id="header-name">User</h3><p>ID: <span id="header-id">123456</span></p></div>
            <div class="balance-pill"><i class="fas fa-coins"></i> <span id="header-balance">0.00</span></div>
        </header>

        <!-- GAME TAB -->
        <div id="tab-game">
            <div class="game-info-bar">
                <div class="period-box"><span class="period-label">Period</span><span class="period-val" id="period-display">---</span></div>
                <div class="timer-box"><span class="period-label" style="color:rgba(255,255,255,0.7)">Count Down</span><span id="timer">00:30</span></div>
            </div>
            <div class="history-bar">
                <div class="history-circles">
                    <div id="h1" class="res-circle" style="background:#444">?</div>
                    <div id="h2" class="res-circle" style="background:#444">?</div>
                    <div id="h3" class="res-circle" style="background:#444">?</div>
                </div>
                <span class="how-to-play" style="color:var(--primary); font-size: 12px; font-weight: bold; text-decoration: underline;">How to play?</span>
            </div>

            <div class="bet-section">
                <div class="color-btn-row">
                    <button class="b-btn bg-green" onclick="selectBet('green', this)">Green <span class="multiplier">x1.5</span></button>
                    <button class="b-btn bg-violet" onclick="selectBet('violet', this)">Violet <span class="multiplier">x4.5</span></button>
                    <button class="b-btn bg-red" onclick="selectBet('red', this)">Red <span class="multiplier">x1.5</span></button>
                </div>
                <div class="num-grid">
                    <div class="n-btn" style="color:var(--red)" onclick="selectBet(0, this)">0</div><div class="n-btn" style="color:var(--green)" onclick="selectBet(1, this)">1</div>
                    <div class="n-btn" style="color:var(--red)" onclick="selectBet(2, this)">2</div><div class="n-btn" style="color:var(--green)" onclick="selectBet(3, this)">3</div>
                    <div class="n-btn" style="color:var(--red)" onclick="selectBet(4, this)">4</div>
                    <div class="n-btn" style="background:var(--violet); color:white" onclick="selectBet(5, this)">5</div>
                    <div class="n-btn" style="color:var(--red)" onclick="selectBet(6, this)">6</div><div class="n-btn" style="color:var(--green)" onclick="selectBet(7, this)">7</div>
                    <div class="n-btn" style="color:var(--red)" onclick="selectBet(8, this)">8</div><div class="n-btn" style="color:var(--green)" onclick="selectBet(9, this)">9</div>
                </div>
                <div class="chip-row">
                    <div class="chip active" onclick="setAmt(10, this)">10</div><div class="chip" onclick="setAmt(100, this)">100</div><div class="chip" onclick="setAmt(500, this)">500</div><div class="chip" onclick="setAmt(1000, this)">1000</div><div class="chip" onclick="setAmt(5000, this)">5000</div>
                </div>
                <div class="confirm-area">
                    <label class="wingo-label">Number of contracts</label>
                    <input type="number" id="bet-qty" class="qty-input" value="1">
                    <label class="wingo-label">Total contract money is <span id="total-money" style="color:var(--primary)">10</span></label>
                    <button class="wingo-btn" onclick="submitBet()">Confirm</button>
                </div>
            </div>

            <div class="live-feed-title"><span>Game Record</span><i class="fas fa-history"></i></div>
            <div class="live-list" id="live-feed"></div>

            <div class="history-section-title">My Bets (Win/Loss)</div>
            <div class="history-list" id="my-bet-history-list"></div>
        </div>

        <!-- WALLET TAB -->
        <div id="tab-wallet" class="hidden">
            <div class="wallet-header">
                <div style="color:rgba(255,255,255,0.7)">Available Balance</div>
                <div class="balance-display">PKR <span id="wallet-bal">0</span></div>
            </div>
            <div class="wallet-tabs">
                <div class="w-tab active" onclick="switchWalletTab('deposit')">Deposit</div>
                <div class="w-tab" onclick="switchWalletTab('withdraw')">Withdraw</div>
            </div>
            
            <div class="form-card">
                <!-- COPY BOX -->
                <div class="deposit-card" onclick="copyNumber()">
                    <div>
                        <div style="font-size:12px; color:var(--text-grey)">Deposit Number</div>
                        <div style="font-weight:bold; font-size:18px; letter-spacing:1px;" id="deposit-number-text">0300-1234567</div>
                    </div>
                    <button class="copy-btn">COPY</button>
                </div>

                <div id="deposit-form">
                    <label class="wingo-label">Amount</label><input type="number" id="dep-amt" class="wingo-input mb-2" placeholder="Enter amount">
                    <label class="wingo-label">Type</label>
                    <select class="wingo-input mb-2" style="background:#2C2C2C; color:white; border:1px solid #333; padding:10px;"><option>JazzCash</option><option>EasyPaisa</option><option>Bank Transfer</option></select>
                    <label class="wingo-label">Transaction ID (TrxID)</label><input type="text" id="dep-trx" class="wingo-input mb-2" placeholder="Paste Trx ID here">
                    <button class="wingo-btn" onclick="requestTx('Deposit')">Submit Deposit</button>
                </div>
                <div id="withdraw-form" class="hidden">
                    <label class="wingo-label">Amount</label><input type="number" id="wd-amt" class="wingo-input mb-2" placeholder="Enter amount">
                    <label class="wingo-label">Account Number</label><input type="number" id="wd-acc" class="wingo-input mb-2" placeholder="0300-XXXXXXX">
                    <button class="wingo-btn" style="background:var(--red)" onclick="requestTx('Withdraw')">Submit Withdraw</button>
                </div>
            </div>

            <div class="history-section-title">Transaction History</div>
            <div class="history-list" id="wallet-history-list"></div>
        </div>

        <nav class="bottom-nav">
            <div class="nav-icon active" onclick="navTo('game', this)"><i class="fas fa-home"></i> Home</div>
            <div class="nav-icon" onclick="navTo('promo', this)"><i class="fas fa-gift"></i> Promo</div>
            <div class="nav-icon" onclick="navTo('wallet', this)"><i class="fas fa-wallet"></i> Wallet</div>
            <div class="nav-icon" onclick="navTo('account', this)"><i class="fas fa-user"></i> Account</div>
        </nav>
    </div>

    <!-- ADMIN PANEL -->
    <div id="admin-app" class="hidden">
        <header class="app-header" style="background:#1a1a1a; border-bottom:1px solid #333;">
            <div class="user-info"><h3 style="color:var(--red)">ADMIN PANEL</h3></div>
            <button onclick="logout()" style="background:none; border:none; color:white; font-size:20px;"><i class="fas fa-power-off"></i></button>
        </header>

        <!-- SERVER ENGINE (NEW LOGIC) -->
        <div class="admin-section" style="border-color: var(--green);">
            <h4 style="margin-top:0; color:var(--green);"><i class="fas fa-server"></i> TIME SYNC ENGINE</h4>
            <p style="font-size:12px; color:var(--text-grey);">Firestore sirf data store karta hai. Timer JS me chalta hai.</p>
            <div class="flex items-center justify-between mb-2">
                <span>Server Clock: <strong id="server-time" style="color:var(--text-grey)">---</strong></span>
                <button id="engine-btn" class="wingo-btn" style="width:auto; padding: 8px 15px; font-size:14px; background: #333;" onclick="toggleGameEngine()">START ENGINE</button>
            </div>
            <div style="font-size:11px; color:#888; margin-top:5px;">Note: Engine local time se round end check karega.</div>
        </div>

        <!-- EVIL MODE -->
        <div class="evil-mode-section" id="evil-box">
            <div class="evil-header">
                <div class="evil-title"><i class="fas fa-user-secret"></i> EVIL MOD ðŸ‘¿</div>
                <label class="toggle-switch">
                    <input type="checkbox" id="evil-toggle" onchange="toggleEvilMode()">
                    <span class="slider"></span>
                </label>
            </div>
            <div id="evil-controls" class="hidden">
                <div class="input-group">
                    <input type="text" id="evil-target-user" class="wingo-input" placeholder="Enter Target Username (e.g. ali)" style="text-align:center; padding-left:15px;">
                </div>
                <div style="font-size:12px; color:var(--text-grey); text-align:center; margin-bottom:10px;">Result will be rigged against this user.</div>
                <button class="wingo-btn" style="background:var(--red);" onclick="setEvilTarget()">SET TARGET</button>
                <div id="evil-status" class="text-center mt-2" style="color:var(--red); font-weight:bold; font-size:12px;"></div>
            </div>
        </div>

        <div class="admin-section">
            <h4 style="margin-top:0; color:#ccc;">Control Next Result</h4>
            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                <span id="admin-period" style="color:var(--primary)">---</span>
                <button onclick="setRandomResult()" style="background:#444; color:white; border:none; padding:5px 10px; border-radius:4px;">Random</button>
            </div>
            <div class="num-grid">
                <div class="n-btn" onclick="adminFix(0)">0</div><div class="n-btn" onclick="adminFix(1)">1</div><div class="n-btn" onclick="adminFix(2)">2</div>
                <div class="n-btn" onclick="adminFix(3)">3</div><div class="n-btn" onclick="adminFix(4)">4</div>
                <div class="n-btn" onclick="adminFix(5)">5</div>
                <div class="n-btn" onclick="adminFix(6)">6</div><div class="n-btn" onclick="adminFix(7)">7</div><div class="n-btn" onclick="adminFix(8)">8</div><div class="n-btn" onclick="adminFix(9)">9</div>
            </div>
            <div id="admin-fix-msg" class="hidden" style="color:var(--green); font-size:12px; text-align:center;">Result Fixed!</div>
        </div>

        <!-- ALL LOSS -->
        <div class="admin-section" style="border-color: var(--red);">
            <h4 style="margin-top:0; color:var(--red);">MASS KILL (ALL LOSS)</h4>
            <p style="font-size:12px; color:var(--text-grey);">Automatically sets result that causes maximum loss to players.</p>
            <button class="wingo-btn" style="background: black; border: 1px solid var(--red); color: var(--red);" onclick="setAllLossResult()">
                <i class="fas fa-skull"></i> ALL LOSS ROUND
            </button>
        </div>

        <div class="admin-section">
            <h4 style="margin-top:0; color:#ccc;">Requests</h4>
            <div id="admin-req-list"></div>
        </div>
    </div>

    <!-- FIREBASE SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, updateDoc, collection, addDoc, query, where, onSnapshot, orderBy, limit, getDocs, serverTimestamp, increment } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        // --- CONFIG (YOUR NEW ONE) ---
        const firebaseConfig = {
            apiKey: "AIzaSyB7atEHWnOo_EzCuFxBRg4xWF51x4atfRQ",
            authDomain: "wingo-new-pro.firebaseapp.com",
            databaseURL: "https://wingo-new-pro-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "wingo-new-pro",
            storageBucket: "wingo-new-pro.firebasestorage.app",
            messagingSenderId: "574707809146",
            appId: "1:574707809146:web:fb0d53fc0a202c4d2934c3",
            measurementId: "G-WED3TVXE62"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUser = null;
        let isEngineRunning = false;
        let engineIntervalId = null; // For Admin "Server" Loop
        
        let betSelection = { type: null, val: null };
        let betAmount = 10;

        // Round Duration (30 seconds)
        const ROUND_DURATION = 30 * 1000; 

        // --- UTILS ---
        window.toast = function(msg, type='info') {
            const box = document.getElementById('toast-box');
            const div = document.createElement('div');
            div.className = `toast-msg toast-${type}`; div.innerText = msg;
            box.appendChild(div); setTimeout(() => div.remove(), 3000);
        }

        // --- AUTH ---
        window.toggleAuth = function() { 
            document.getElementById('login-box').classList.toggle('hidden'); 
            document.getElementById('register-box').classList.toggle('hidden'); 
        }

        window.authUser = async function() {
            const u = document.getElementById('login-user').value;
            const p = document.getElementById('login-pass').value;
            
            if(u === 'admin@wingo.com' && p === 'admin123') {
                initAdminPanel();
                return;
            }

            try {
                const userCredential = await signInWithEmailAndPassword(auth, u, p);
            } catch (error) {
                toast('Login Failed', 'error');
            }
        }

        window.registerUser = async function() {
            const email = document.getElementById('reg-user').value;
            const name = document.getElementById('reg-name').value;
            const pass = document.getElementById('reg-pass').value;

            if(!email || !name || !pass) return toast('Fill all fields', 'error');

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, pass);
                await setDoc(doc(db, "users", userCredential.user.uid), {
                    email: email,
                    name: name,
                    balance: 1000,
                    role: 'user',
                    createdAt: serverTimestamp()
                });
                toast('Registered Successfully', 'success');
            } catch (error) {
                toast('Registration Failed', 'error');
            }
        }

        window.logout = function() {
            if(isEngineRunning) toggleGameEngine();
            if(currentUser?.role === 'admin') {
                currentUser = null;
                document.getElementById('admin-app').classList.add('hidden');
                document.getElementById('auth-screen').classList.remove('hidden');
            } else {
                signOut(auth);
                location.reload();
            }
        }

        onAuthStateChanged(auth, (user) => {
            if (user && currentUser?.role !== 'admin') {
                fetchUserData(user.uid);
            } else if (!user && currentUser?.role !== 'admin') {
                document.getElementById('auth-screen').classList.remove('hidden');
            }
        });

        async function fetchUserData(uid) {
            const docSnap = await getDoc(doc(db, "users", uid));
            if (docSnap.exists()) {
                currentUser = { uid, ...docSnap.data() };
                initUserPanel();
            }
        }

        // --- GLOBAL GAME LISTENER (THE CORE SYNC LOGIC) ---
        function listenToGlobalGame() {
            const globalDocRef = doc(db, "game_control", "global");
            
            // Realtime Listener
            onSnapshot(globalDocRef, (doc) => {
                if (doc.exists()) {
                    const data = doc.data();
                    
                    // Update Period
                    document.getElementById('period-display').innerText = data.period;
                    if(document.getElementById('admin-app').classList.contains('hidden') === false) {
                        document.getElementById('admin-period').innerText = data.period;
                    }

                    // --- CALCULATE TIMER VIA JS (NO DB READ) ---
                    // Logic: Time Left = (StartTime + 30s) - Now
                    if (data.startTime) {
                        const endTime = data.startTime + ROUND_DURATION;
                        const now = Date.now();
                        let diff = endTime - now;
                        
                        if (diff < 0) diff = 0; // Timer ended
                        
                        const t = Math.floor(diff / 1000).toString().padStart(2,'0');
                        const s = (Math.floor(diff / 1000) % 60).toString().padStart(2,'0');
                        const timerEl = document.getElementById('timer');
                        timerEl.innerText = `${t}:${s}`;
                        
                        if(t <= 5) { timerEl.style.color = 'var(--red)'; } 
                        else { timerEl.style.color = 'white'; }

                        // Check Result Logic locally to update UI immediately
                        if (data.lastResult !== undefined) {
                            shiftHistory(data.lastResult);
                            if(currentUser?.uid) checkMyBets(data.period, data.lastResult);
                        }
                    } else {
                         // If round is just starting (data.lastResult undefined), but we are already in next period window
                         // We need to ensure we don't show old result.
                         // But mostly, the admin sets lastResult only after round ends.
                         document.getElementById('timer').innerText = "00:30";
                    }
                }
            });
        }

        // --- USER FUNCTIONS ---
        function initUserPanel() {
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('user-app').classList.remove('hidden');
            document.getElementById('header-name').innerText = currentUser.name;
            document.getElementById('header-id').innerText = currentUser.uid.slice(0,6);
            
            listenToUserBalance();
            listenToGlobalGame();
            renderMyGameHistory();
            
            setInterval(() => {
                const t = parseInt(document.getElementById('timer').innerText.split(':')[1]);
                if(t > 5 && Math.random() > 0.7) addFakeBotBet();
            }, 2000);
        }

        function listenToUserBalance() {
            onSnapshot(doc(db, "users", currentUser.uid), (doc) => {
                if(doc.exists()) {
                    currentUser.balance = doc.data().balance;
                    updateBalanceUI();
                }
            });
        }

        function updateBalanceUI() {
            document.getElementById('header-balance').innerText = currentUser.balance.toFixed(2);
            document.getElementById('wallet-bal').innerText = currentUser.balance.toFixed(2);
        }

        window.navTo = function(tab, btn) {
            document.getElementById('tab-game').classList.add('hidden'); document.getElementById('tab-wallet').classList.add('hidden');
            if(tab === 'game') document.getElementById('tab-game').classList.remove('hidden');
            if(tab === 'wallet') { document.getElementById('tab-wallet').classList.remove('hidden'); renderWalletHistory(); }
            document.querySelectorAll('.nav-icon').forEach(x => x.classList.remove('active')); btn.classList.add('active');
        }

        /* BETTING */
        window.selectBet = function(val, el) {
            betSelection.type = typeof val === 'number' ? 'num' : 'color'; betSelection.val = val;
            document.querySelectorAll('.n-btn, .b-btn').forEach(x => x.classList.remove('selected')); el.classList.add('selected');
            window.updateTotalCalc();
        }
        window.setAmt = function(amt, el) {
            betAmount = amt; document.getElementById('bet-qty').value = 1;
            document.querySelectorAll('.chip').forEach(x => x.classList.remove('active')); el.classList.add('active'); window.updateTotalCalc();
        }
        window.updateTotalCalc = function() {
            const qty = parseInt(document.getElementById('bet-qty').value) || 1;
            document.getElementById('total-money').innerText = (betAmount * qty);
        }
        document.getElementById('bet-qty').addEventListener('input', window.updateTotalCalc);

        window.submitBet = async function() {
            if(!betSelection.type) return toast('Select a prediction', 'error');
            
            // Check Local Timer (Strict Check)
            const globalDoc = await getDoc(doc(db, "game_control", "global"));
            const data = globalDoc.data();
            
            if(!data.startTime) return toast('Engine not started', 'error');

            const now = Date.now();
            const timeLeft = (data.startTime + ROUND_DURATION) - now;
            
            if(timeLeft <= 5000) return toast('Betting Closed', 'error'); // 5 seconds left
            
            const total = betAmount * parseInt(document.getElementById('bet-qty').value);
            if(currentUser.balance < total) return toast('Insufficient balance', 'error');

            try {
                await updateDoc(doc(db, "users", currentUser.uid), { balance: currentUser.balance - total });

                await addDoc(collection(db, "bets"), {
                    userId: currentUser.uid,
                    userName: currentUser.name,
                    period: data.period,
                    type: betSelection.type,
                    val: betSelection.val,
                    amt: total,
                    status: 'pending',
                    timestamp: serverTimestamp()
                });

                window.addFeedItem(currentUser.name, betSelection.val, total);
                toast('Bet Placed', 'success');
                
                document.querySelectorAll('.n-btn, .b-btn').forEach(x => x.classList.remove('selected')); betSelection = {type:null, val:null};
            } catch (e) {
                toast('Error: ' + e.message, 'error');
            }
        }

        async function checkMyBets(period, result) {
            const q = query(collection(db, "bets"), where("userId", "==", currentUser.uid), where("period", "==", period));
            const querySnapshot = await getDocs(q);
            let hasWin = false, totalWin = 0;

            const colors = {0:'violet',1:'green',2:'red',3:'green',4:'red',5:'violet',6:'red',7:'green',8:'red',9:'green'};
            const winColor = colors[result];

            querySnapshot.forEach(async (docSnap) => {
                const bet = docSnap.data();
                if(bet.status === 'pending') {
                    let won = false; let winAmt = 0;
                    if(bet.type === 'num' && bet.val === result) { won = true; winAmt = bet.amt * 9; }
                    else if(bet.type === 'color' && bet.val === winColor) { won = true; winAmt = bet.amt * (winColor==='violet'?4.5:1.5); }

                    if(won) {
                        hasWin = true; totalWin += winAmt;
                        await updateDoc(doc(db, "users", currentUser.uid), { balance: currentUser.balance + winAmt }); 
                    }
                    await updateDoc(doc(db, "bets", docSnap.id), { status: won ? 'win' : 'loss' });
                }
            });
            
            if(hasWin) showWinLossPopup(true, totalWin);
        }

        window.showWinLossPopup = function(isWin, amount) {
            const modal = document.getElementById('win-loss-modal'), card = document.getElementById('modal-card'), iconEl = document.getElementById('modal-icon-el'), titleEl = document.getElementById('modal-title'), amtEl = document.getElementById('modal-amt');
            modal.classList.remove('hidden');
            if (isWin) {
                card.className = 'modal-content win pop-in'; iconEl.className = 'fas fa-check'; titleEl.innerText = 'Congratulations!'; amtEl.innerText = '+' + amount.toFixed(2);
            } else {
                card.className = 'modal-content loss pop-in'; iconEl.className = 'fas fa-times'; titleEl.innerText = 'Try Again'; amtEl.innerText = '-' + amount.toFixed(2);
            }
        }
        window.closePopup = function() { document.getElementById('win-loss-modal').classList.add('hidden'); }

        function shiftHistory(res) {
            const bg = (res === 1 || res === 3 || res === 7 || res === 9) ? 'var(--green)' : (res === 2 || res === 4 || res === 6 || res === 8) ? 'var(--red)' : 'var(--violet)';
            const h1 = document.getElementById('h1'), h2 = document.getElementById('h2'), h3 = document.getElementById('h3');
            h3.style.background = h2.style.background; h3.innerText = h2.innerText;
            h2.style.background = h1.style.background; h2.innerText = h1.innerText;
            h1.style.background = bg; h1.innerText = res; h1.classList.add('pop-in'); setTimeout(()=>h1.classList.remove('pop-in'), 300);
        }

        async function renderMyGameHistory() {
            const list = document.getElementById('my-bet-history-list');
            const q = query(collection(db, "bets"), where("userId", "==", currentUser.uid), orderBy("timestamp", "desc"), limit(20));
            const snapshot = await getDocs(q);
            
            list.innerHTML = '';
            if(snapshot.empty) { list.innerHTML = '<div class="text-center p-3" style="color:#555">No bets yet</div>'; return; }
            
            snapshot.forEach(doc => {
                const b = doc.data();
                const div = document.createElement('div'); div.className = 'h-item';
                const statusClass = b.status === 'win' ? 'status-win' : (b.status === 'loss' ? 'status-loss' : 'status-pending');
                const statusText = b.status.charAt(0).toUpperCase() + b.status.slice(1);
                div.innerHTML = `<div class="h-left"><span class="h-period">Period: ${b.period}</span><span class="h-detail">Select: ${b.val} (${b.type})</span></div><div class="text-right"><div class="h-amount ${statusClass}">${b.amt}</div><div class="${statusClass}" style="font-size:12px; font-weight:bold;">${statusText}</div></div>`;
                list.appendChild(div);
            });
        }

        async function renderWalletHistory() {
            const list = document.getElementById('wallet-history-list');
            const q = query(collection(db, "transactions"), where("userId", "==", currentUser.uid), orderBy("timestamp", "desc"), limit(20));
            const snapshot = await getDocs(q);
            
            list.innerHTML = '';
            if(snapshot.empty) { list.innerHTML = '<div class="text-center p-3" style="color:#555">No transactions</div>'; return; }
            
            snapshot.forEach(doc => {
                const t = doc.data();
                const div = document.createElement('div'); div.className = 'h-item';
                let statusColor = '#ccc'; if(t.status === 'Completed') statusColor = 'var(--green)'; if(t.status === 'Pending') statusColor = 'var(--primary)'; if(t.status === 'Rejected') statusColor = 'var(--red)';
                div.innerHTML = `<div class="h-left"><span class="h-period">${t.type}</span><span class="h-detail" style="font-size:12px;">${new Date(t.timestamp.toDate()).toLocaleTimeString()}</span></div><div class="text-right"><div class="h-amount" style="color:var(--primary)">${t.amt}</div><div style="font-size:12px; color:${statusColor}; font-weight:bold;">${t.status}</div></div>`;
                list.appendChild(div);
            });
        }

        window.switchWalletTab = function(type) {
            document.querySelectorAll('.w-tab').forEach(x => x.classList.remove('active')); event.target.classList.add('active');
            if(type === 'deposit') { document.getElementById('deposit-form').classList.remove('hidden'); document.getElementById('withdraw-form').classList.add('hidden'); } 
            else { document.getElementById('deposit-form').classList.add('hidden'); document.getElementById('withdraw-form').classList.remove('hidden'); }
        }
        
        window.copyNumber = function() {
            const num = document.getElementById('deposit-number-text').innerText;
            navigator.clipboard.writeText(num).then(() => toast('Number Copied!', 'success'));
        }

        window.requestTx = async function(type) {
            const amt = type==='Deposit' ? document.getElementById('dep-amt').value : document.getElementById('wd-amt').value;
            if(!amt || amt <= 0) return toast('Enter valid amount', 'error');
            
            await addDoc(collection(db, "transactions"), {
                userId: currentUser.uid,
                userName: currentUser.name,
                type: type, amt: parseFloat(amt), status: 'Pending',
                timestamp: serverTimestamp()
            });
            renderWalletHistory(); toast('Request Sent', 'success');
        }

        /* --- ADMIN PANEL & TIME SYNC ENGINE --- */
        function initAdminPanel() {
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('admin-app').classList.remove('hidden');
            listenToGlobalGame();
            renderAdminReqs();
            
            // Display Local Time
            setInterval(() => {
                document.getElementById('server-time').innerText = new Date().toLocaleTimeString();
            }, 1000);

            // AUTO START ENGINE
            toggleGameEngine();
        }

        window.toggleGameEngine = async function() {
            if (!isEngineRunning) {
                // START ENGINE
                isEngineRunning = true;
                document.getElementById('engine-btn').innerText = "STOP ENGINE";
                document.getElementById('engine-btn').style.background = "var(--red)";
                
                // 1. Initial Setup if not present
                const snap = await getDoc(doc(db, "game_control", "global"));
                if (!snap.exists()) {
                    const now = Date.now();
                    const period = generatePeriodId(new Date(now));
                    await setDoc(doc(db, "game_control", "global"), {
                        period: period,
                        startTime: now,
                        lastResult: null,
                        nextResult: null,
                        evilMode: false,
                        evilTarget: null
                    });
                    toast("Engine Started", "success");
                }

                // 2. Start Interval (Server Simulation)
                engineIntervalId = setInterval(runGameEngineLoop, 1000);

            } else {
                // STOP ENGINE
                isEngineRunning = false;
                clearInterval(engineIntervalId);
                document.getElementById('engine-btn').innerText = "START ENGINE";
                document.getElementById('engine-btn').style.background = "linear-gradient(90deg, var(--primary), var(--primary-dark))";
            }
        }

        // --- THE ENGINE LOGIC (Local Time Check) ---
        async function runGameEngineLoop() {
            if(!isEngineRunning) return;

            try {
                const globalRef = doc(db, "game_control", "global");
                const snap = await getDoc(globalRef);
                const data = snap.data();
                
                const now = Date.now();
                const roundEndTime = data.startTime + ROUND_DURATION;
                const currentPeriod = data.period;

                // Check if Round Ended
                if (now >= roundEndTime) {
                    
                    // --- ROUND END ---
                    
                    // 1. Determine Result
                    let finalRes = data.nextResult !== null ? data.nextResult : Math.floor(Math.random()*10);
                    
                    // Evil Mode Override
                    if (data.evilMode && data.evilTarget) {
                         // Get target bet
                        const q = query(collection(db, "bets"), where("period", "==", currentPeriod), where("userName", "==", data.evilTarget));
                        const tSnap = await getDocs(q);
                        if(!tSnap.empty) {
                            finalRes = getLosingResult(tSnap.docs[0].data());
                        }
                    }

                    // 2. Process Backend Bets
                    await processBackendBets(currentPeriod, finalRes, data);

                    // 3. Update Firestore (State Change)
                    const nextPeriodStr = getNextPeriod(currentPeriod);
                    const nextStartTime = data.startTime + ROUND_DURATION; // Next starts exactly when this ended
                    
                    await updateDoc(globalRef, {
                        period: nextPeriodStr,
                        startTime: nextStartTime,
                        lastResult: finalRes,
                        nextResult: null // Clear fixed for next round
                    });

                } else {
                    // Round is running... nothing to do.
                    // Just wait... (Timer is handled by User Listener)
                }
            } catch (error) {
                console.error("Engine Error:", error);
                toast("Engine Error: " + error.message, 'error');
            }
        }

        function getLosingResult(bet) {
            if (bet.type === 'color') {
                if (bet.val === 'red') return [1,3,7,9,0,5][Math.floor(Math.random()*6)];
                if (bet.val === 'green') return [2,4,6,8,0,5][Math.floor(Math.random()*6)];
                if (bet.val === 'violet') return [1,2,3,4,6,7,8,9][Math.floor(Math.random()*8)];
            }
            if (bet.type === 'num') {
                let r = Math.floor(Math.random() * 10);
                while(r === bet.val) r = Math.floor(Math.random() * 10);
                return r;
            }
            return Math.floor(Math.random() * 10);
        }

        async function processBackendBets(period, result, gameData) {
            const q = query(collection(db, "bets"), where("period", "==", period));
            const snapshot = await getDocs(q);
            const currentBets = [];
            snapshot.forEach(d => currentBets.push(d.data()));

            const colors = {0:'violet',1:'green',2:'red',3:'green',4:'red',5:'violet',6:'red',7:'green',8:'red',9:'green'};
            const winColor = colors[result];

            for (const bet of currentBets) {
                if (bet.status === 'pending') {
                    let won = false; let winAmt = 0;
                    if(bet.type === 'num' && bet.val === result) { won = true; winAmt = bet.amt * 9; }
                    else if(bet.type === 'color' && bet.val === winColor) { won = true; winAmt = bet.amt * (winColor==='violet'?4.5:1.5); }

                    if (won) {
                        const uRef = doc(db, "users", bet.userId);
                        await updateDoc(uRef, { balance: increment(winAmt) });
                    }
                    await updateDoc(doc(db, "bets", bet.timestamp.seconds ? bet.id : bet.timestamp), { status: won ? 'win' : 'loss' });
                }
            }
        }

        // Admin Controls
        window.adminFix = async function(num) {
            const globalRef = doc(db, "game_control", "global");
            await updateDoc(globalRef, { nextResult: num });
            toast(`Result fixed to ${num}`, 'success');
            document.getElementById('admin-fix-msg').innerText = `Result Fixed!`;
            document.getElementById('admin-fix-msg').classList.remove('hidden');
        }
        
        window.setRandomResult = function() { 
            const globalRef = doc(db, "game_control", "global");
            updateDoc(globalRef, { nextResult: null }); 
            toast('Random result set', 'success'); 
        }

        window.toggleEvilMode = async function() {
            const isChecked = document.getElementById('evil-toggle').checked;
            const controls = document.getElementById('evil-controls');
            const box = document.getElementById('evil-box');
            if (isChecked) {
                controls.classList.remove('hidden'); box.classList.add('active-evil');
                await updateDoc(doc(db, "game_control", "global"), { evilMode: true });
            } else {
                controls.classList.add('hidden'); box.classList.remove('active-evil');
                await updateDoc(doc(db, "game_control", "global"), { evilMode: false, evilTarget: null });
                document.getElementById('evil-status').innerText = '';
            }
        }

        window.setEvilTarget = async function() {
            const target = document.getElementById('evil-target-user').value.trim();
            if(!target) return toast('Enter username', 'error');
            await updateDoc(doc(db, "game_control", "global"), { evilTarget: target });
            document.getElementById('evil-status').innerText = `Targeting: ${target}`;
            toast(`Evil Mode Active against ${target}`, 'success');
        }

        window.setAllLossResult = async function() {
            const globalDoc = await getDoc(doc(db, "game_control", "global"));
            const period = globalDoc.data().period;
            
            const q = query(collection(db, "bets"), where("period", "==", period));
            const snapshot = await getDocs(q);
            const currentBets = [];
            snapshot.forEach(d => currentBets.push(d.data()));

            if(currentBets.length === 0) { window.setRandomResult(); toast('No bets, random result set', 'info'); return; }
            
            let minPayout = Infinity; let bestNumber = 0;
            for(let i=0; i<=9; i++) {
                let currentPayout = 0;
                const colorMap = {0:'violet',1:'green',2:'red',3:'green',4:'red',5:'violet',6:'red',7:'green',8:'red',9:'green'};
                const winColor = colorMap[i];

                currentBets.forEach(bet => {
                    let won = false;
                    if(bet.type === 'num' && bet.val === i) won = true;
                    else if(bet.type === 'color' && bet.val === winColor) won = true;

                    if(won) {
                        let multiplier = 9;
                        if(bet.type === 'color') multiplier = (winColor === 'violet') ? 4.5 : 1.5;
                        currentPayout += bet.amt * multiplier;
                    }
                });

                if(currentPayout < minPayout) { minPayout = currentPayout; bestNumber = i; }
            }
            
            await updateDoc(doc(db, "game_control", "global"), { nextResult: bestNumber });
            toast(`ALL LOSS SET! (Result: ${bestNumber})`, 'success');
        }

        async function renderAdminReqs() {
            const list = document.getElementById('admin-req-list');
            const q = query(collection(db, "transactions"), where("status", "==", "Pending"));
            const snapshot = await getDocs(q);
            
            list.innerHTML = '';
            if(snapshot.empty) list.innerHTML = '<div style="padding:10px; color:#666">No pending requests</div>';

            snapshot.forEach(d => {
                const t = d.data();
                const div = document.createElement('div');
                div.style.padding = '10px'; div.style.background = '#2a2a2a'; div.style.marginBottom = '5px'; div.style.borderRadius = '5px';
                div.innerHTML = `<div class="flex justify-between items-center"><span>${t.userName} - ${t.type} ${t.amt}</span><div><button id="app-${d.id}" style="color:green; background:none; border:none; cursor:pointer;">âœ“</button><button id="rej-${d.id}" style="color:red; background:none; border:none; cursor:pointer;">âœ—</button></div></div>`;
                list.appendChild(div);
                
                document.getElementById(`app-${d.id}`).onclick = () => processRequest(d.id, 'Approved', t);
                document.getElementById(`rej-${d.id}`).onclick = () => processRequest(d.id, 'Rejected', t);
            });
        }

        async function processRequest(id, status, txData) {
            await updateDoc(doc(db, "transactions", id), { status: status });

            if(status === 'Approved' && txData.type === 'Deposit') {
                const uQ = query(collection(db, "users"), where("name", "==", txData.userName));
                const uSnap = await getDocs(uQ);
                if(!uSnap.empty) {
                    const uDoc = uSnap.docs[0];
                    const currentBal = uDoc.data().balance;
                    await updateDoc(doc(db, "users", uDoc.id), { balance: currentBal + txData.amt });
                }
            }
            renderAdminReqs();
        }

        /* FAKE BOTS */
        const botNames = ['Ali***', 'Ahm***', 'Usm***', 'Ham***', 'Kha***', 'Riz***']; 
        const botOpts = ['Green', 'Violet', 'Red', 1, 3, 7, 9, 2, 4, 6, 8];
        
        function addFakeBotBet() {
            const name = botNames[Math.floor(Math.random()*botNames.length)], 
                  val = botOpts[Math.floor(Math.random()*botOpts.length)], 
                  amt = [10, 50, 100, 500, 1000][Math.floor(Math.random()*5)];
            addFeedItem(name, val, amt);
        }

        function addFeedItem(name, val, amt) {
            const list = document.getElementById('live-feed');
            if(list.children[0]?.innerText === "New round started") list.innerHTML = "";
            const div = document.createElement('div'); div.className = 'live-item';
            let color = '#fff'; 
            if(val === 'Green' || [1,3,7,9].includes(val)) color = 'var(--green)'; 
            if(val === 'Red' || [2,4,6,8].includes(val)) color = 'var(--red)'; 
            if(val === 'Violet' || [0,5].includes(val)) color = 'var(--violet)';
            div.innerHTML = `<div class="avatar-placeholder"><i class="fas fa-user"></i></div><div style="flex:1"><div style="font-weight:bold; font-size:12px;">${name}</div><div style="color:${color}; font-weight:bold;">${val}</div></div><div style="color:var(--primary); font-weight:bold;">${amt}</div>`;
            list.prepend(div);
        }

        // Helper Functions
        function generatePeriodId(dateObj) {
            return dateObj.getFullYear().toString() + (dateObj.getMonth()+1).toString().padStart(2,'0') + dateObj.getDate().toString().padStart(2,'0') + "001";
        }

        function getNextPeriod(current) {
            let pNum = parseInt(current.slice(-3)) + 1;
            return current.slice(0,-3) + pNum.toString().padStart(3,'0');
        }
    </script>
</body>
</html>
